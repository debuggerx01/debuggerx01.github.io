<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>迁移Flutter项目到空安全的血泪史——有血、有泪、有💩 | DebuggerX's Blog</title><meta name="author" content="DebuggerX"><meta name="copyright" content="DebuggerX"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="2021年3月4日，Flutter正式发布2.0版本——这一天，我回想起了，被脱发支配的恐怖……发际线再次失守的屈辱……  升级后的错误修复如果升级后打开已有项目，还能够正常通过编译，那么恭喜你，这说明你拥有作为 IT 人的最强技能——强运，且敏捷属性点满自带回避 BUG 和异常的效果 👍  然"><link rel="shortcut icon" href="/images/favicon.png"><link rel="canonical" href="http://blog.debuggerx.com/2021/03/07/migrate-flutter-project-to-null-safety/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.1.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?45acc9824a216a8f1792b419eb91f090";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '迁移Flutter项目到空安全的血泪史——有血、有泪、有💩',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-11-20 16:57:49'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="referrer" content="no-referrer-when-downgrade" /><link rel="stylesheet" href="/md_editor/css/editormd.min.css"><link rel="stylesheet" href="/custom/custom.css"><meta name="generator" content="Hexo 6.0.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/images/avatar.webp" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">38</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">31</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 文档</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://hexo.io/zh-cn/docs/"><i class="fa-fw fas fa-book"></i><span> Hexo</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/categories/Docs%E6%96%87%E6%AA%94/"><i class="fa-fw fas fa-paint-brush"></i><span> Butterfly</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-smile-o"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/videos/"><i class="fa-fw fas fa-play-circle"></i><span> 视频</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="//debuggerx.com/emulator_js"><i class="fa-fw fas fa-gamepad"></i><span> 游戏</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-tools"></i><span> 工具</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/md_editor/"><i class="fa-fw fas fa-pen"></i><span> MDEditor</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="http://www.debuggerx.com/dgm_web"><i class="fa-fw fas fa-hand-peace"></i><span> DDE手势管理器</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/2021/03/07/migrate-flutter-project-to-null-safety/cover.webp')"><nav id="nav"><span id="blog-info"><a href="/" title="DebuggerX's Blog"><span class="site-name">DebuggerX's Blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 文档</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://hexo.io/zh-cn/docs/"><i class="fa-fw fas fa-book"></i><span> Hexo</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/categories/Docs%E6%96%87%E6%AA%94/"><i class="fa-fw fas fa-paint-brush"></i><span> Butterfly</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-smile-o"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/videos/"><i class="fa-fw fas fa-play-circle"></i><span> 视频</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="//debuggerx.com/emulator_js"><i class="fa-fw fas fa-gamepad"></i><span> 游戏</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-tools"></i><span> 工具</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/md_editor/"><i class="fa-fw fas fa-pen"></i><span> MDEditor</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="http://www.debuggerx.com/dgm_web"><i class="fa-fw fas fa-hand-peace"></i><span> DDE手势管理器</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">迁移Flutter项目到空安全的血泪史——有血、有泪、有💩</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-03-06T16:45:18.000Z" title="发表于 2021-03-07 00:45:18">2021-03-07</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-11-20T08:57:49.068Z" title="更新于 2024-11-20 16:57:49">2024-11-20</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7/">奇技淫巧</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">4.3k</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="迁移Flutter项目到空安全的血泪史——有血、有泪、有💩"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><blockquote>
<p>2021年3月4日，Flutter正式发布2.0版本——这一天，我回想起了，被脱发支配的恐怖……发际线再次失守的屈辱……</p>
</blockquote>
<h1 id="升级后的错误修复"><a href="#升级后的错误修复" class="headerlink" title="升级后的错误修复"></a>升级后的错误修复</h1><p>如果升级后打开已有项目，还能够正常通过编译，那么恭喜你，这说明你拥有作为 IT 人的最强技能——强运，且敏捷属性点满自带回避 BUG 和异常的效果 <span class="github-emoji"><span>👍</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f44d.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span></p>
<blockquote>
<p>然而其实除非项目规模太小，就没引入几个依赖包，大概率此时会因为依赖冲突或者其他插件包内的错误导致编译失败的 <span class="github-emoji"><span>😑</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f611.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> 。比如我在做的公司项目，引入了接近 40 个依赖和插件，结果自然是原地爆炸 <span class="github-emoji"><span>😒</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f612.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>……下面就以我的情况为例，介绍一下几种常见情况的处理方法。</p>
</blockquote>
<h2 id="charts-flutter-与-flutter-localizations-冲突"><a href="#charts-flutter-与-flutter-localizations-冲突" class="headerlink" title="charts_flutter 与 flutter_localizations 冲突"></a>charts_flutter 与 flutter_localizations 冲突</h2><p>我的项目中使用了 <a target="_blank" rel="noopener" href="https://pub.flutter-io.cn/packages/charts_flutter">charts_flutter</a> 这个库用于图表的显示，升级 SDK 后执行 <code>flutter pub get</code> 安装依赖时第一个报出的错误就是：<br><img src="/2021/03/07/migrate-flutter-project-to-null-safety/error1.webp" alt="error1"><br>根据报错信息得知，charts_flutter 这个库指定了其引用的 intl 库版本小于 0.17.0，而更新后 flutter SDK 中引用的 intl 库版本正好就是 0.17.0，所以引发了冲突。<br>碰到这种库中的依赖与 SDK 中的引用冲突的情况，应该优先去库的 issue 区看看有没有相关的讨论，比如：<br><img src="/2021/03/07/migrate-flutter-project-to-null-safety/issue1.webp" alt="issue1.webp"><br>然后可以找到这样一个谈论：<a target="_blank" rel="noopener" href="https://github.com/google/charts/issues/579">Add null safety #579</a>，其中提到了两种解决方案：</p>
<h3 id="依赖版本覆盖法-dependency-overrides"><a href="#依赖版本覆盖法-dependency-overrides" class="headerlink" title="依赖版本覆盖法 dependency_overrides"></a>依赖版本覆盖法 dependency_overrides</h3><p>这是一种相对比较直接粗暴的方法，既然问题处在一个A包要求引用的C包小于某个版本，而B包要求引用的C包恰好大于等于这个版本，那么如果实际上A包实际上也能正常使用高版本的C包，只是因为依赖关系还没来得及更新，那么可以在我们项目的<code>pubspec.yaml</code>中加上类似这样的一段：</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dependency_overrides:</span></span><br><span class="line">  <span class="attr">intl:</span> <span class="string">^0.17.0</span></span><br></pre></td></tr></tbody></table></figure>
<p>这样 <code>flutter pub get</code> 时就会忽略上面的错误，尝试使用高版本的包进行依赖分析和下载。</p>
<h3 id="修改依赖法-通过-git-方式引用修改过的库"><a href="#修改依赖法-通过-git-方式引用修改过的库" class="headerlink" title="修改依赖法 通过 git 方式引用修改过的库"></a>修改依赖法 通过 git 方式引用修改过的库</h3><p>上面的修改完成后，这个包就可以通过依赖检查和编译了。但是当我升级了另外一个包时，又出现冲突，这次显示的是 charts_flutter 所以引用的 flutter_svg 这个库的版本和其他库有冲突。<br>这个问题在上面的 issue 中也有人提到，一种方法是继续增加 dependency_overrides：</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dependency_overrides:</span></span><br><span class="line">  <span class="attr">intl:</span> <span class="string">^0.17.0</span></span><br><span class="line">  <span class="attr">flutter_svg:</span> <span class="string">^0.19.3</span></span><br></pre></td></tr></tbody></table></figure>
<p>这样会导致这个覆盖列表越来越长，后面会忘记每条覆盖都是为了解决哪个库的冲突，所以还可以用另一种方式，将原本<code>pubspec.yaml</code>中的依赖从：</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dependencies:</span></span><br><span class="line">  <span class="string">……</span></span><br><span class="line">  <span class="attr">charts_flutter:</span> <span class="string">^0.9.0</span></span><br><span class="line">  <span class="string">……</span></span><br></pre></td></tr></tbody></table></figure>
<p>改为：</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dependencies:</span></span><br><span class="line">  <span class="string">……</span></span><br><span class="line">  <span class="attr">charts_flutter:</span></span><br><span class="line">    <span class="attr">git:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">charts_flutter</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">https://github.com/ahammer/charts.git</span></span><br><span class="line">  <span class="string">……</span></span><br></pre></td></tr></tbody></table></figure>
<p>这样的形式，也就是让<code>flutter pub get</code>解决下载依赖包时从制定的 git 仓库获取，而不是 pub 仓库。上面地址中的 charts_flutter 的依赖已经被仓库所有者更改过，避免了之前碰到的冲突。等到库的原作者更新了版本解决了问题，只要把这里的 git 依赖删掉，重新改为指定版本的形式，就可以切换回从 pub 仓库下载依赖，而不用去管 dependency_overrides 的问题了。</p>
<h2 id="device-preview-编译错误"><a href="#device-preview-编译错误" class="headerlink" title="device_preview 编译错误"></a>device_preview 编译错误</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://pub.flutter-io.cn/packages/device_preview">device_preview</a> 是一个非常神奇且实用的工具包，参考这个在线 demo ：<a target="_blank" rel="noopener" href="https://flutter-device-preview.firebaseapp.com/#/starter">device-preview-starter</a>，它可以让我们在开发时在同一个界面上模拟查看 app 在各种平台和设备上的运行显示效果，非常适合做页面适配时的预览。除此之外，它还提供了快速切换语言、明暗主题、屏幕方向等功能。</p>
</blockquote>
<p>当解决了各种依赖冲突之后，终于能够执行 <code>flutter run</code>编译项目，然而却报错了：<br><img src="/2021/03/07/migrate-flutter-project-to-null-safety/error2.webp" alt="error2.webp"><br>还是老样子，根据报错，确定是 <code>device_preview</code> 这个包的错误，那么去翻一下 issue，然后可以找到这个讨论：<a target="_blank" rel="noopener" href="https://github.com/aloisdeniel/flutter_device_preview/issues/91">No named parameter with the name ‘nullOk’ #91</a> ：<br><img src="/2021/03/07/migrate-flutter-project-to-null-safety/issue2.webp" alt="issue2.webp"><br>也就是说出错的原因是包中使用的一个flutter API发生了变化，所以只能升级包的版本：</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dependencies:</span></span><br><span class="line">  <span class="string">……</span></span><br><span class="line">  <span class="attr">device_preview:</span> <span class="string">^0.6.2-beta</span></span><br><span class="line">  <span class="string">……</span></span><br></pre></td></tr></tbody></table></figure>
<p>这样就能编译通过了。</p>
<h1 id="迁移至空安全"><a href="#迁移至空安全" class="headerlink" title="迁移至空安全"></a>迁移至空安全</h1><blockquote>
<p>关于空安全是什么，有什么好处，主要可以看看下面的文章和视频：</p>
</blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="https://dart.cn/null-safety">dart-doc : 健全的空安全</a></li>
<li><a target="_blank" rel="noopener" href="https://dart.cn/null-safety/understanding-null-safety">dart-doc : 深入理解空安全</a></li>
</ul>
<iframe id="bili1" width="100%" src="//player.bilibili.com/player.html?aid=711531376&amp;bvid=BV1TD4y1U7ST&amp;cid=218839091&amp;page=1&amp;autoplay=0" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>

<script>
    var bili1 = document.querySelector('#bili1');
    var container = document.querySelector('#article-container');
    bili1.height = (container.clientWidth * 3 / 4) + 'px';
</script>

<p>或许你在以往的开发过程中早就苦于各种“空异常（NPE）”久矣，或者看了上面的资料后中对现代化语言中关于“空安全”的讨论后，应该能够理解将整个项目迁移到空安全语法中可以大大降低程序出错的概率，从而节省了debug的时间提高了开发效率。然而迁移已有工程到空安全并不是一件容易的事……</p>
<p>关于迁移的官方建议和演示可以参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://dart.cn/null-safety/migration-guide">dart-doc : 迁移至空安全</a></li>
</ul>
<iframe id="bili2" width="100%" src="//player.bilibili.com/player.html?aid=799460080&amp;bvid=BV1sy4y1a7SA&amp;cid=305745798&amp;page=1&amp;autoplay=0" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>
<script>
    var bili2 = document.querySelector('#bili2');
    var container = document.querySelector('#article-container');
    bili2.height = (container.clientWidth * 3 / 4) + 'px';
</script>

<blockquote>
<p>官方推荐的迁移流程是：<br>    1. 等待项目依赖的所有软件包迁移完成。<br>    2. 迁移项目代码，最好使用交互式的迁移工具。<br>    3. 确保静态分析所有问题已被解决（IDE不再有报错）。<br>    4. 运行代码，测试程序运行。<br>    然而我觉得这有些过于理想不太现实……<br>    首先，我的项目中的包相对比较多，相当一部分的包还没有迁移到空安全：<br>    <img src="/2021/03/07/migrate-flutter-project-to-null-safety/outdate.webp" alt="outdate.webp"><br>    而且其中有些包年久失修，想要等它们全部自己更新不知还要多久……另外官方推荐的那个交互式迁移工具感觉也不是很好用。</p>
</blockquote>
<p>所以我的建议是，为了趁早获得空安全语法对后续开发的效率提升，可以先手工迁移项目中的源码，然后看情况更新一部分依赖包为 nullsafety 版本，并将项目的编译模式改为<code>非健全的空安全混合模式</code>，之后持续更新依赖包，并视情况手动更新一些升级无望的小众依赖包。</p>
<h2 id="更新项目代码"><a href="#更新项目代码" class="headerlink" title="更新项目代码"></a>更新项目代码</h2><p>做好心理准备，如果项目已经具有相当规模，接下来的修改将会是一场持久战（我花了大约5个多小时 <span class="github-emoji"><span>💀</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f480.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>）</p>
<h3 id="修改项目配置，激活空安全检查"><a href="#修改项目配置，激活空安全检查" class="headerlink" title="修改项目配置，激活空安全检查"></a>修改项目配置，激活空安全检查</h3><p><img src="/2021/03/07/migrate-flutter-project-to-null-safety/migrate1.webp" alt="migrate1.webp"><br>如图，先修改项目的<code>pubspec.yaml</code>文件，将最低 SDK 版本设置到 2.12.0：</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">environment:</span></span><br><span class="line">  <span class="attr">sdk:</span> <span class="string">'&gt;=2.12.0 &lt;3.0.0'</span></span><br></pre></td></tr></tbody></table></figure>
<p>然后执行<code>dart pub get</code>命令重新生成软件包的配置文件，点击 IDE 中 dart 静态分析器的刷新按钮，之后将看到分析出的项目中不符合空安全语法的错误：<br><img src="/2021/03/07/migrate-flutter-project-to-null-safety/migrate2.webp" alt="migrate2.webp"></p>
<h3 id="善用-IDE-提示功能及自动修正功能-逐个修复所有问题"><a href="#善用-IDE-提示功能及自动修正功能-逐个修复所有问题" class="headerlink" title="善用 IDE 提示功能及自动修正功能 逐个修复所有问题"></a>善用 IDE 提示功能及自动修正功能 逐个修复所有问题</h3><p>这一步就是大量的重复工作，简单来说是按需添加 ?、!、required 以及 late 来消除静态错误，但具体应该用哪个，实际上还是比较考验对 dart 语言的精通程度以及对 flutter 框架的理解的。举几个例子：</p>
<ol>
<li><p>‘?’ 还是 ‘!’<br><img src="/2021/03/07/migrate-flutter-project-to-null-safety/migrate3.webp" alt="migrate3.webp"><br>在上图所示的问题处，IDE给我们的提示是，由于 <code>addPostFrameCallback</code> 方法可能作用于 ‘null’，所以需要在 <code>WidgetsBinding.instance</code> 的后面加上 ‘?’ 或者 ‘!’。如果只是为了修复语法错误，两者都是可以的，但实际上效果却完全不同：</p>
<ol>
<li>如果使用了 ‘?’ ，那么运行时 runtime 还是会对<code>WidgetsBinding.instance</code>进行null检查，如果为空则不继续调用<code>addPostFrameCallback</code> 方法，从而避免了NPE异常，但缺点是非空检查会带来额外的性能开销；</li>
<li>如果使用了’!’，那么运行时 runtime 就不会对<code>WidgetsBinding.instance</code>进行null检查，可能会导致运行时的 NPE 空异常。</li>
</ol>
<p>查看<code>WidgetsBinding.instance</code>的源码如下：<br><img src="/2021/03/07/migrate-flutter-project-to-null-safety/migrate4.webp" alt="migrate4.webp"><br>可以得知，如果是在执行<code>runApp</code>之前调用此属性，那么需要先执行<code>WidgetsFlutterBinding.ensureInitialized()</code>方法确保其不为空，也就是说，只要是在<code>runApp</code>之后的代码里<code>WidgetsBinding.instance</code>都不会为 ‘null’ 的——查看<code>runApp</code>的源码如下：<br><img src="/2021/03/07/migrate-flutter-project-to-null-safety/migrate5.webp" alt="migrate5.webp"><br>可以看到该方法内已经执行了<code>WidgetsFlutterBinding.ensureInitialized()</code>。<br>由于我们的 App 都是以<code>runApp</code>作为入口开始的界面显示和事件循环，所以是可以保证<code>WidgetsBinding.instance</code>不为 ‘null’ 的，那么为了提高效率，项目中所有类似的错误都是可以放心大胆地使用 ‘!’ 来进行空安全语法的修复的。</p>
</li>
<li><p>‘required’ 和 ‘@required’<br><img src="/2021/03/07/migrate-flutter-project-to-null-safety/migrate6.webp" alt="migrate6.webp"><br>如上图的错误所示，在之前的语法中，函数定义中的命名参数默认是可选的，而调用时必填的参数则用 <code>@required</code> 修饰。而在新的空安全语法中，命名参数只允许有三种情况：</p>
<ol>
<li>使用 ‘required’ 前缀修饰符，表示其调用时必须传入非空的值；</li>
<li>使用 ‘?’ 修饰其类型，表示调用时可以传入空值或不指明；</li>
<li>给该参数设置非空默认值。</li>
</ol>
<p>由于之前项目代码里所有用 ‘@required’ 修饰的代码都符合第一种情况，所以可以利用 IDE 的全局替换功能，直接把项目代码中所有的 ‘@required’ 批量替换成 ‘required’，节省一部分手工修改的工作量。</p>
</li>
<li><p>‘dynamic’ 和 ‘Object’<br>项目中有些页面包含了相似的组件，比如一列按钮，这时会有类似这样的代码：</p>
<figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) {</span><br><span class="line">    <span class="keyword">final</span> options = [</span><br><span class="line">      [</span><br><span class="line">        context.s.settings_label_upgrade,</span><br><span class="line">        () =&gt; context.n.pushNamed(SettingPagesRouter.upgrade),</span><br><span class="line">      ],</span><br><span class="line">      [</span><br><span class="line">        context.s.settings_label_app_setting,</span><br><span class="line">        () =&gt; context.n.pushNamed(SettingPagesRouter.appSettings),</span><br><span class="line">      ],</span><br><span class="line">      [</span><br><span class="line">        context.s.settings_label_share,</span><br><span class="line">        H.voidFunc,</span><br><span class="line">      ],</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Column(</span><br><span class="line">      children: options</span><br><span class="line">          .map((e) =&gt; GestureDetector(</span><br><span class="line">                onTap: e[<span class="number">1</span>],</span><br><span class="line">                child: Text(e[<span class="number">0</span>]),</span><br><span class="line">              ))</span><br><span class="line">          .toList(),</span><br><span class="line">    );</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>也就是将这些组件的一些属性提取出来作为数组，在代码中循环动态生成组件并应用这些属性。上面的代码在之前的语法中是正常的，因为<code>options.map((e) =&gt; ...)</code>这里的 e 的类型会被当作 <code>List&lt;dynamic&gt;</code>，也就是 e 中的元素都是任意类型，传入到需要 <code>String</code> 类型的地方它就会被当作字符串使用，传入需要函数的位置它就会被当作是函数使用，语法检查器不会报错。<br>但是新语法下，会报如下错误：<br><img src="/2021/03/07/migrate-flutter-project-to-null-safety/migrate7.webp" alt="migrate7.webp"><br>也就是说现在如果以字面量方式声明一个 var 类型的数组，而且数组内的类型不止一种，那么语法检查器会认为数组的类型为<code>List&lt;Object&gt;</code>而不是<code>List&lt;dynamic&gt;</code>，Object 虽然是所有非空类型的父类，但是和 dynamic 不同，不能自动隐式转换为所需类型。所以这里有三种改法：</p>
<ol>
<li>使用 as 显式转换类型： <figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> Column(</span><br><span class="line">    children: options</span><br><span class="line">        .map((e) =&gt; GestureDetector(</span><br><span class="line">              onTap: e[<span class="number">1</span>] <span class="keyword">as</span> GestureTapCallback,</span><br><span class="line">              child: Text(e[<span class="number">0</span>] <span class="keyword">as</span> <span class="built_in">String</span>),</span><br><span class="line">            ))</span><br><span class="line">        .toList(),</span><br><span class="line">  );</span><br></pre></td></tr></tbody></table></figure></li>
<li>指定数组类型为<code>List&lt;dynamic&gt;</code>： <figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="built_in">List</span>&lt;<span class="built_in">List</span>&lt;<span class="built_in">dynamic</span>&gt;&gt; options = [ …… ];</span><br></pre></td></tr></tbody></table></figure></li>
<li>不用数组，改为定义class：<br><img src="/2021/03/07/migrate-flutter-project-to-null-safety/migrate8.webp" alt="migrate8.webp"></li>
</ol>
</li>
</ol>
<blockquote>
<p>其他还有一些迁移中容易碰到的问题，建议阅读：<a target="_blank" rel="noopener" href="https://dart.cn/null-safety/faq">空安全：常见问题</a></p>
</blockquote>
<h2 id="运行混合版本的代码"><a href="#运行混合版本的代码" class="headerlink" title="运行混合版本的代码"></a>运行混合版本的代码</h2><p>迁移完成之后，即使语法检查全部通过，IDE 不再报错，此时运行项目还是会报如下错误：<br><img src="/2021/03/07/migrate-flutter-project-to-null-safety/migrate9.webp" alt="migrate9.webp"></p>
<p>参考：<a target="_blank" rel="noopener" href="https://dart.cn/null-safety/unsound-null-safety">dart-doc : 非健全的空安全</a>，最简单实用的方法还是在<code>lib/main.dart</code>的第一行加入<code>// @dart=2.9</code>：</p>
<figure class="highlight dart"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @dart=2.9</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'src/my_app.dart'</span>;</span><br><span class="line"></span><br><span class="line">main() {</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>这样在开发编写代码时，可以享受空安全语法检查带来的体验提升，而在编译时使用混合模式，不强制所有的依赖包都完全迁移到了空安全。</p>
<h2 id="逐步迁移依赖库"><a href="#逐步迁移依赖库" class="headerlink" title="逐步迁移依赖库"></a>逐步迁移依赖库</h2><p>为了最终可以实现整个项目<code>健全的空安全</code>模式，还是需要一步步迁移依赖库的。首先还是运行<code>dart pub outdated --mode=null-safety</code>命令，根据提示将已经发布了 nullsafety 版本的库的版本更新，然后运行<code>flutter pub get</code>看看是否存在依赖冲突，如果有的话用上面的方法尝试解决，不行的话则将对应的包的版本回退，优先确保项目能够正常运行。<br>之后每隔一段时间，比如一周左右，重复上面的操作，直至所有的依赖包不再冲突，全部升级为 nullsafety 版本后，删除<code>lib/main.dart</code>第一行的<code>// @dart=2.9</code>注释，使整个项目运行于健全的空安全模式。</p>
<h2 id="手动修改部分依赖包"><a href="#手动修改部分依赖包" class="headerlink" title="手动修改部分依赖包"></a>手动修改部分依赖包</h2><p>而对于某些小众的、升级无望的依赖包，可以尝试用本地引用的方式加入项目代码库，然后手动升级为 nullsafety 版本。<br>以我在 <a href="/2021/02/18/qrs-detector-for-flutter-in-dart/">qrs_detector——Flutter应用中的心电心率识别</a> 中提到的 <a target="_blank" rel="noopener" href="https://pub.flutter-io.cn/packages/iirjdart">iirjdart</a> 这个库为例，它是一个很小众的用于信号滤波的库，从 2020-05-01 上传 0.0.1 版本以来没有过任何更新，仓库的 issue 区也没有任何活动，所以很可能作者不会主动去更新为 nullsafety 版本了。而且使用到现在，这个库本身的逻辑工作得相当稳定，也没有依赖其他什么包，所以很适合自己手工移植。</p>
<h3 id="复制库源码至项目目录下"><a href="#复制库源码至项目目录下" class="headerlink" title="复制库源码至项目目录下"></a>复制库源码至项目目录下</h3><blockquote>
<p>为了便于管理，我在项目根目录下创建了名为<code>3rd_party</code>的目录，将所有需要修改的第三方库的源码放在这个目录下</p>
</blockquote>
<p>首先找到依赖库的源码，可以从本地缓存目录中复制，利用 IDE 快速找到缓存的源码位置方法如下：<br><img src="/2021/03/07/migrate-flutter-project-to-null-safety/migrate10.webp" alt="migrate10.webp"></p>
<p>或者也可以从 GitHub 上下载源码。<br>之后把整个源码目录去掉版本号，复制到创建的<code>3rd_party</code>目录下，删除源码内包括<code>example</code>在内等无用的代码和资源。</p>
<h3 id="修改项目的pubspec-yaml，改为路径引用的方式："><a href="#修改项目的pubspec-yaml，改为路径引用的方式：" class="headerlink" title="修改项目的pubspec.yaml，改为路径引用的方式："></a>修改项目的<code>pubspec.yaml</code>，改为路径引用的方式：</h3><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dependencies:</span></span><br><span class="line">  <span class="string">……</span></span><br><span class="line">  <span class="attr">iirjdart:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">3rd_party/iirjdart</span></span><br><span class="line">  <span class="string">……</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="将库改为支持-nullsafety-语法"><a href="#将库改为支持-nullsafety-语法" class="headerlink" title="将库改为支持 nullsafety 语法"></a>将库改为支持 nullsafety 语法</h3><p>修改<code>3rd_party</code>下库源码中的<code>pubspec.yaml</code>，和前面的操作一样，改为</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">environment:</span></span><br><span class="line">  <span class="attr">sdk:</span> <span class="string">'&gt;=2.12.0 &lt;3.0.0'</span></span><br></pre></td></tr></tbody></table></figure>
<p>然后执行<code>dart pub get</code>命令重新生成软件包的配置文件，此时 IDE 即会显示该库的语法错误，用之前使用的各种技巧修改源码，使其通过语法检查。</p>
<blockquote>
<p>有时候改完库的源码后，由于对外暴露的 API 也发生了变更，可能还需要回过头来改项目中调用位置的代码，需要注意一下</p>
</blockquote>
<h3 id="测试运行"><a href="#测试运行" class="headerlink" title="测试运行"></a>测试运行</h3><p>这样修改之后，需要尽量进行全面的测试，确保没有给库带来意外的问题。如果确定修改成功，则可以在补完其<code>example</code>之后，通过提交 pr 的方式向库的原仓库贡献。这样一旦原作者接受 pr ，其他使用这个库的用户就可以方便的使用你修改的版本，而且项目中的依赖方式也可以不用再使用路径引用的方式，可以及时获得后续的更新。</p>
<blockquote>
<p>写到这里，本次 Flutter 更新后项目代码修改移植的经历和经验就差不多完成了……但是实际上和 nullsafety 有关的尝试和折腾还远没有结束。。。后面几篇文章还会记录一下，我将自己三年前编写的、用于在 Flutter 开发中生成 json 解析模板类的工具更新到支持 nullsafety 语法的过程，以及我解决由于版本更新后，Flutter 的 Android Studio 多语言本地化插件不能正常工作的方法～</p>
</blockquote>
<h1 id="更新（2021-5-14）"><a href="#更新（2021-5-14）" class="headerlink" title="更新（2021-5-14）"></a>更新（2021-5-14）</h1><p>终于、终于，项目的全部依赖都已迁移至空安全<span class="github-emoji"><span>😭</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f62d.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>。这么长时间以来，项目中只剩三个钉子户一直没能更新，现在分别记录下：</p>
<h3 id="scidart"><a href="#scidart" class="headerlink" title="scidart"></a>scidart</h3><p>这是个科学计算的库，用项目中实时心率识别的算法。在我的“反复催促”下最终由作者更新： <a target="_blank" rel="noopener" href="https://github.com/scidart/scidart/issues/24">Migrate to null safety #24</a></p>
<h3 id="flutter-custom-dialog"><a href="#flutter-custom-dialog" class="headerlink" title="flutter_custom_dialog"></a>flutter_custom_dialog</h3><p>这是一个用于弹出自定义对话框的库，还是很好用的，但是已经很久没有维护了。最终有位大兄弟 fork 了一份，更新为空安全后上传至了 pub 仓库为 <a target="_blank" rel="noopener" href="https://pub.flutter-io.cn/packages/flutter_custom_dialog_tv">flutter_custom_dialog_tv</a>，所以将依赖更新为： <code>flutter_custom_dialog_tv: ^1.0.20-nullsafety</code> 即可。</p>
<h3 id="charts-flutter"><a href="#charts-flutter" class="headerlink" title="charts_flutter"></a>charts_flutter</h3><p>这是一个由谷歌员工上传的图表库，拥有极高的使用量和人气，但是原作者同样很久没有及时更新，而且由于该库的实现相当“学术派”，很难自己修改迁移为空安全……在长期关注了 <a target="_blank" rel="noopener" href="https://github.com/google/charts/issues/579">Add null safety #579</a> 这个讨论无果后，最终我决定将其替换为 <a target="_blank" rel="noopener" href="https://pub.flutter-io.cn/packages/fl_chart">fl_chart</a> 这个库，并重新实现相关的项目代码……</p>
<p>至此，终于可以移除 <code>lib/main.dart</code>中的<code>// @dart=2.9</code>标记，项目完全运行在健全的空安全模式了 <span class="github-emoji"><span>🎉</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f389.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span></p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%89%8D%E7%AB%AF/">前端</a><a class="post-meta__tags" href="/tags/flutter/">flutter</a><a class="post-meta__tags" href="/tags/dart/">dart</a></div><div class="post_share"><div class="social-share" data-image="/2021/03/07/migrate-flutter-project-to-null-safety/cover.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/04/20/jsonformat4flutter-v0-9-nullsafety/" title="JSONFormat4Flutter v0.9 更新说明"><img class="cover" src="/2021/04/20/jsonformat4flutter-v0-9-nullsafety/cover.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">JSONFormat4Flutter v0.9 更新说明</div></div></a></div><div class="next-post pull-right"><a href="/2021/02/23/a-app-bug-caused-by-hand-cream/" title="记一个由护手霜引发的BUG"><img class="cover" src="/2021/02/23/a-app-bug-caused-by-hand-cream/cover.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">记一个由护手霜引发的BUG</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2020/12/31/manage-i18n-resources-gracefully/" title="优雅地管理国际化资源——i18n-manager"><img class="cover" src="/2020/12/31/manage-i18n-resources-gracefully/cover.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-12-31</div><div class="title">优雅地管理国际化资源——i18n-manager</div></div></a></div><div><a href="/2020/12/29/these-years-about-flutter-and-me/" title="这些年，我与Flutter……"><img class="cover" src="/2020/12/29/these-years-about-flutter-and-me/cover.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-12-29</div><div class="title">这些年，我与Flutter……</div></div></a></div><div><a href="/2021/02/23/a-app-bug-caused-by-hand-cream/" title="记一个由护手霜引发的BUG"><img class="cover" src="/2021/02/23/a-app-bug-caused-by-hand-cream/cover.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-02-23</div><div class="title">记一个由护手霜引发的BUG</div></div></a></div><div><a href="/2021/04/20/jsonformat4flutter-v0-9-nullsafety/" title="JSONFormat4Flutter v0.9 更新说明"><img class="cover" src="/2021/04/20/jsonformat4flutter-v0-9-nullsafety/cover.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-04-20</div><div class="title">JSONFormat4Flutter v0.9 更新说明</div></div></a></div><div><a href="/2022/04/17/conditional-compilation-using-source-gen-in-flutter-1/" title="在 flutter 中利用 source_gen 实现条件编译（上）"><img class="cover" src="/2022/04/17/conditional-compilation-using-source-gen-in-flutter-1/cover.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-17</div><div class="title">在 flutter 中利用 source_gen 实现条件编译（上）</div></div></a></div><div><a href="/2022/06/19/conditional-compilation-using-source-gen-in-flutter-2/" title="在 flutter 中利用 source_gen 实现条件编译（中）"><img class="cover" src="/2022/04/17/conditional-compilation-using-source-gen-in-flutter-1/cover.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-06-19</div><div class="title">在 flutter 中利用 source_gen 实现条件编译（中）</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/images/avatar.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">DebuggerX</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">38</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">31</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/debuggerx01"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%87%E7%BA%A7%E5%90%8E%E7%9A%84%E9%94%99%E8%AF%AF%E4%BF%AE%E5%A4%8D"><span class="toc-number">1.</span> <span class="toc-text">升级后的错误修复</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#charts-flutter-%E4%B8%8E-flutter-localizations-%E5%86%B2%E7%AA%81"><span class="toc-number">1.1.</span> <span class="toc-text">charts_flutter 与 flutter_localizations 冲突</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E7%89%88%E6%9C%AC%E8%A6%86%E7%9B%96%E6%B3%95-dependency-overrides"><span class="toc-number">1.1.1.</span> <span class="toc-text">依赖版本覆盖法 dependency_overrides</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E4%BE%9D%E8%B5%96%E6%B3%95-%E9%80%9A%E8%BF%87-git-%E6%96%B9%E5%BC%8F%E5%BC%95%E7%94%A8%E4%BF%AE%E6%94%B9%E8%BF%87%E7%9A%84%E5%BA%93"><span class="toc-number">1.1.2.</span> <span class="toc-text">修改依赖法 通过 git 方式引用修改过的库</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#device-preview-%E7%BC%96%E8%AF%91%E9%94%99%E8%AF%AF"><span class="toc-number">1.2.</span> <span class="toc-text">device_preview 编译错误</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BF%81%E7%A7%BB%E8%87%B3%E7%A9%BA%E5%AE%89%E5%85%A8"><span class="toc-number">2.</span> <span class="toc-text">迁移至空安全</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81"><span class="toc-number">2.1.</span> <span class="toc-text">更新项目代码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE%EF%BC%8C%E6%BF%80%E6%B4%BB%E7%A9%BA%E5%AE%89%E5%85%A8%E6%A3%80%E6%9F%A5"><span class="toc-number">2.1.1.</span> <span class="toc-text">修改项目配置，激活空安全检查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%96%84%E7%94%A8-IDE-%E6%8F%90%E7%A4%BA%E5%8A%9F%E8%83%BD%E5%8F%8A%E8%87%AA%E5%8A%A8%E4%BF%AE%E6%AD%A3%E5%8A%9F%E8%83%BD-%E9%80%90%E4%B8%AA%E4%BF%AE%E5%A4%8D%E6%89%80%E6%9C%89%E9%97%AE%E9%A2%98"><span class="toc-number">2.1.2.</span> <span class="toc-text">善用 IDE 提示功能及自动修正功能 逐个修复所有问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E6%B7%B7%E5%90%88%E7%89%88%E6%9C%AC%E7%9A%84%E4%BB%A3%E7%A0%81"><span class="toc-number">2.2.</span> <span class="toc-text">运行混合版本的代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%90%E6%AD%A5%E8%BF%81%E7%A7%BB%E4%BE%9D%E8%B5%96%E5%BA%93"><span class="toc-number">2.3.</span> <span class="toc-text">逐步迁移依赖库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E4%BF%AE%E6%94%B9%E9%83%A8%E5%88%86%E4%BE%9D%E8%B5%96%E5%8C%85"><span class="toc-number">2.4.</span> <span class="toc-text">手动修改部分依赖包</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E5%88%B6%E5%BA%93%E6%BA%90%E7%A0%81%E8%87%B3%E9%A1%B9%E7%9B%AE%E7%9B%AE%E5%BD%95%E4%B8%8B"><span class="toc-number">2.4.1.</span> <span class="toc-text">复制库源码至项目目录下</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E9%A1%B9%E7%9B%AE%E7%9A%84pubspec-yaml%EF%BC%8C%E6%94%B9%E4%B8%BA%E8%B7%AF%E5%BE%84%E5%BC%95%E7%94%A8%E7%9A%84%E6%96%B9%E5%BC%8F%EF%BC%9A"><span class="toc-number">2.4.2.</span> <span class="toc-text">修改项目的pubspec.yaml，改为路径引用的方式：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%BA%93%E6%94%B9%E4%B8%BA%E6%94%AF%E6%8C%81-nullsafety-%E8%AF%AD%E6%B3%95"><span class="toc-number">2.4.3.</span> <span class="toc-text">将库改为支持 nullsafety 语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E8%BF%90%E8%A1%8C"><span class="toc-number">2.4.4.</span> <span class="toc-text">测试运行</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%EF%BC%882021-5-14%EF%BC%89"><span class="toc-number">3.</span> <span class="toc-text">更新（2021-5-14）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#scidart"><span class="toc-number">3.0.1.</span> <span class="toc-text">scidart</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#flutter-custom-dialog"><span class="toc-number">3.0.2.</span> <span class="toc-text">flutter_custom_dialog</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#charts-flutter"><span class="toc-number">3.0.3.</span> <span class="toc-text">charts_flutter</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/12/08/weekly-todo-app/" title="每周TODO——个人向待办管理工具"><img src="/2024/12/08/weekly-todo-app/cover.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="每周TODO——个人向待办管理工具"/></a><div class="content"><a class="title" href="/2024/12/08/weekly-todo-app/" title="每周TODO——个人向待办管理工具">每周TODO——个人向待办管理工具</a><time datetime="2024-12-08T06:43:10.000Z" title="发表于 2024-12-08 14:43:10">2024-12-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/10/07/map-scancodes-to-keycodes/" title="Linux通用键位修改"><img src="/2022/03/27/set-global-keybindings-via-xbindkeys/cover.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux通用键位修改"/></a><div class="content"><a class="title" href="/2023/10/07/map-scancodes-to-keycodes/" title="Linux通用键位修改">Linux通用键位修改</a><time datetime="2023-10-07T09:18:05.000Z" title="发表于 2023-10-07 17:18:05">2023-10-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/09/20/fcitx5-customizer/" title="fcitx5_customizer —— 一个让 Fcitx5 更符合简中用户使用习惯的优化脚本"><img src="/2023/09/20/fcitx5-customizer/cover.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="fcitx5_customizer —— 一个让 Fcitx5 更符合简中用户使用习惯的优化脚本"/></a><div class="content"><a class="title" href="/2023/09/20/fcitx5-customizer/" title="fcitx5_customizer —— 一个让 Fcitx5 更符合简中用户使用习惯的优化脚本">fcitx5_customizer —— 一个让 Fcitx5 更符合简中用户使用习惯的优化脚本</a><time datetime="2023-09-20T04:24:21.000Z" title="发表于 2023-09-20 12:24:21">2023-09-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/07/18/remote-system-monitor/" title="远程监视器——使用Flutter/Dart开发的Linux系统状态监视APP"><img src="/2023/07/18/remote-system-monitor/cover.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="远程监视器——使用Flutter/Dart开发的Linux系统状态监视APP"/></a><div class="content"><a class="title" href="/2023/07/18/remote-system-monitor/" title="远程监视器——使用Flutter/Dart开发的Linux系统状态监视APP">远程监视器——使用Flutter/Dart开发的Linux系统状态监视APP</a><time datetime="2023-07-18T01:36:03.000Z" title="发表于 2023-07-18 09:36:03">2023-07-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/20/conditional-compilation-using-source-gen-in-flutter-3/" title="在 flutter 中利用 source_gen 实现条件编译（下）"><img src="/2022/04/17/conditional-compilation-using-source-gen-in-flutter-1/cover.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="在 flutter 中利用 source_gen 实现条件编译（下）"/></a><div class="content"><a class="title" href="/2023/06/20/conditional-compilation-using-source-gen-in-flutter-3/" title="在 flutter 中利用 source_gen 实现条件编译（下）">在 flutter 中利用 source_gen 实现条件编译（下）</a><time datetime="2023-06-20T14:36:52.000Z" title="发表于 2023-06-20 22:36:52">2023-06-20</time></div></div></div></div></div></div></main><footer id="footer" style="background: linear-gradient(20deg, #0062be, #9855e1, #6f42c1, #541bba)"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By DebuggerX</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script src="/custom/custom.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>